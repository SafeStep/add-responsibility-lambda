 {
    "AWSTemplateFormatVersion":"2010-09-09", 
    "Description":"Stack to create the add responsibility system", 
    "Resources": {
        "AddResponsibilityRole": {
            "Type":"AWS::IAM::Role", 
            "Properties": {
                "AssumeRolePolicyDocument": {
                    "Version":"2012-10-17", 
                    "Statement":[ {"Effect":"Allow", "Principal": {"Service":["lambda.amazonaws.com"]}, "Action":["sts:AssumeRole"] }]
                }, 
                "Path":"/", 
                "Policies":[ {
                    "PolicyName":"AddResponsibilityPolicy", 
                    "PolicyDocument": {
                        "Version":"2012-10-17", 
                        "Statement":[ {
                                "Effect":"Allow", 
                                "Action":["logs:*"], 
                                "Resource":"arn:aws:logs:*:*:*"
                            },  {
                                "Effect":"Allow", 
                                "Action":["dynamodb:Query"], 
                                "Resource":"arn:aws:dynamodb:eu-west-1:209523969378:responsibility-store"
                            },  {
                                "Effect":"Allow", 
                                "Action":["dynamodb:GetItem", "dynamodb:Query"], 
                                "Resource":"arn:aws:dynamodb:eu-west-1:209523969378:emergency-contact-store"
                            },  {
                                "Effect":"Allow", 
                                "Action":["sqs:ReceiveMessage", "sqs:DeleteMessage", "sqs:GetQueueAttributes"], 
                                "Resource": {"Fn::GetAtt":["AddResponsibilityQueue", "Arn"]}
                            }
                        ]
                    }
                }]
            }
        }, 
        "AddResponsibilityQueue": {
            "Type":"AWS::SQS::Queue", 
            "Properties": {
                "DelaySeconds": 0,
                "QueueName": "add-responsibility-queue"
            }
        },
        "AddResponsibilityLambda": {
            "Type":"AWS::Lambda::Function", 
            "Properties": {
                "FunctionName":"add-responsibility", 
                "Role": {"Fn::GetAtt":["AddResponsibilityRole", "Arn"] }, 
                "Runtime":"nodejs12.x", 
                "Handler":"src/index.handler", 
                "EventSourceArn": {"Fn::GetAtt":["AddResponsibilityQueue", "Arn"]}, 
                "Code": {
                    "S3Bucket":"safe-step-lambda-functions-source", 
                    "S3Key":"add-responsibility.zip"
                }
            }
        }
    }
}